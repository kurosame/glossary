## category

hardware

## titles

Memory
メモリ

## description

### メモリ領域

メモリ領域は以下 4 つの領域に分かれている  
開発の際にはヒープ領域とスタック領域を意識する

- プログラム領域  
  プログラムを格納

- 静的領域  
  グローバル変数などを格納

- ヒープ領域  
   動的に管理される領域の格納（new 演算子などの領域）  
   実行時にならないと正確なメモリサイズを判断できないため、動的にメモリを確保しておく  
   クラスの実態やオブジェクトを保持している  
   必ずポインタのアドレスから参照するので、速度は若干落ちる

  - メモリリーク  
    ルートからアクセス可能の状態で残っており、GC で処理できない  
    JS だと v8 でオブジェクトを開放できない時に発生する

- スタック領域  
  プリミティブ型データやポインタアドレスを格納  
  そのまま使える為、高速

### ライフサイクル

- メモリ割り当て  
  メモリは OS によって割り当てられ、プログラムで使用できるようになる  
  低水準言語（C など）では開発者が必要な時に明示的に行う必要がある  
  高水準言語では言語が自動で割り当てる

- メモリ使用  
  プログラムが実際に割り当てたメモリを使うこと  
  例えばコード上の変数割り当てが使用される際に、読み出し及び書き込みの操作が行われる

- メモリ解放  
  不要なメモリが解放され、そのメモリを再度利用することができる状態  
  低水準言語では開発者が明示的にメモリを解放する  
  高水準言語では GC で自動的にメモリから解放してくれる

### GC の仕組み

ヒープ領域内では新しいデータと古いデータで内部的に分けて管理されている

新しいデータだけを対象にした GC を Minor GC と呼ぶ  
Minor GC は処理時間が短く、実行される頻度が高い  
一定回数 Minor GC で処理できなかったデータは、古いデータとして別の領域に保持される  
つまり、古いデータは長期的に参照されているデータが保持される

新しいデータと古いデータの両方を対象にした GC を Full GC と呼ぶ  
Full GC は古いデータも対象にしているので、Minor GC よりも時間がかかる

当然、Minor GC と Full GC 実行中は CPU を使用して処理しているので、アプリケーションのパフォーマンスに影響する  
Minor GC でメモリから解放されるように実装することで、Full GC の実行を抑えることができ、パフォーマンス改善に繋がる
